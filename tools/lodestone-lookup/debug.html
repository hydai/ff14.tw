<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lodestone API Èô§ÈåØÊ∏¨Ë©¶</title>
    <style>
        body {
            font-family: monospace;
            margin: 20px;
            background: #1a1a1a;
            color: #0f0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #0ff;
        }
        .input-group {
            margin: 20px 0;
        }
        input {
            padding: 10px;
            font-size: 16px;
            background: #333;
            color: #0f0;
            border: 1px solid #0f0;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background: #0f0;
            color: #000;
            border: none;
            cursor: pointer;
            margin-left: 10px;
        }
        button:hover {
            background: #0ff;
        }
        .output {
            background: #000;
            border: 1px solid #0f0;
            padding: 20px;
            margin: 20px 0;
            white-space: pre-wrap;
            overflow-x: auto;
            min-height: 400px;
        }
        .error {
            color: #f00;
        }
        .success {
            color: #0f0;
        }
        .info {
            color: #ff0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Lodestone API Èô§ÈåØÊ∏¨Ë©¶Â∑•ÂÖ∑</h1>
        
        <div class="input-group">
            <input type="text" id="characterId" placeholder="Ëº∏ÂÖ•ËßíËâ≤ ID (‰æãÂ¶Ç: 12345678)" value="12345678">
            <button onclick="testAPI()">Ê∏¨Ë©¶ API</button>
            <button onclick="clearOutput()">Ê∏ÖÈô§Ëº∏Âá∫</button>
        </div>
        
        <div class="output" id="output">
Á≠âÂæÖÊ∏¨Ë©¶...
        </div>
    </div>

    <script>
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            output.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        function clearOutput() {
            output.innerHTML = 'Ëº∏Âá∫Â∑≤Ê∏ÖÈô§ÔºåÁ≠âÂæÖÊñ∞ÁöÑÊ∏¨Ë©¶...\n';
        }
        
        async function testAPI() {
            const characterId = document.getElementById('characterId').value.trim();
            
            log('========== ÈñãÂßãÊ∏¨Ë©¶ ==========', 'info');
            log(`Ê∏¨Ë©¶ËßíËâ≤ ID: ${characterId}`, 'info');
            
            if (!characterId) {
                log('ÈåØË™§ÔºöË´ãËº∏ÂÖ•ËßíËâ≤ ID', 'error');
                return;
            }
            
            const apiUrl = `https://logstone.z54981220.workers.dev/character/${characterId}`;
            log(`API URL: ${apiUrl}`, 'info');
            
            try {
                log('ÁôºÈÄÅ HTTP Ë´ãÊ±Ç...', 'info');
                const startTime = performance.now();
                
                const response = await fetch(apiUrl);
                
                const endTime = performance.now();
                const responseTime = (endTime - startTime).toFixed(2);
                
                log(`ÂõûÊáâÊôÇÈñì: ${responseTime}ms`, 'success');
                log(`HTTP ÁãÄÊÖãÁ¢º: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                // È°ØÁ§∫ÊâÄÊúâ headers
                log('\n=== Response Headers ===', 'info');
                for (const [key, value] of response.headers.entries()) {
                    log(`${key}: ${value}`, 'info');
                }
                
                // ÂèñÂæóÂõûÊáâÂÖßÂÆπ
                const responseText = await response.text();
                log(`\n=== ÂéüÂßãÂõûÊáâÂÖßÂÆπ (Èï∑Â∫¶: ${responseText.length} Â≠óÂÖÉ) ===`, 'info');
                log(responseText, 'success');
                
                // ÂòóË©¶Ëß£Êûê JSON
                try {
                    const data = JSON.parse(responseText);
                    log('\n=== JSON Ëß£ÊûêÊàêÂäü ===', 'success');
                    log(JSON.stringify(data, null, 2), 'success');
                    
                    // È°ØÁ§∫Ë≥áÊñôÁµêÊßãÂàÜÊûê
                    log('\n=== Ë≥áÊñôÁµêÊßãÂàÜÊûê ===', 'info');
                    log(`Ë≥áÊñôÈ°ûÂûã: ${typeof data}`, 'info');
                    log(`È†ÇÂ±§Â±¨ÊÄß: ${Object.keys(data).join(', ')}`, 'info');
                    
                    // È°ØÁ§∫ÂêÑÂÄãÊ¨Ñ‰Ωç
                    for (const [key, value] of Object.entries(data)) {
                        log(`${key}: ${typeof value === 'object' ? JSON.stringify(value) : value}`, 'info');
                    }
                    
                } catch (parseError) {
                    log('\n=== JSON Ëß£ÊûêÂ§±Êïó ===', 'error');
                    log(`ÈåØË™§Ë®äÊÅØ: ${parseError.message}`, 'error');
                    log('ÂõûÊáâÂÖßÂÆπ‰∏çÊòØÊúâÊïàÁöÑ JSON Ê†ºÂºè', 'error');
                }
                
            } catch (error) {
                log('\n=== Ë´ãÊ±ÇÂ§±Êïó ===', 'error');
                log(`ÈåØË™§È°ûÂûã: ${error.name}`, 'error');
                log(`ÈåØË™§Ë®äÊÅØ: ${error.message}`, 'error');
                log(`ÈåØË™§Â†ÜÁñä:\n${error.stack}`, 'error');
                
                // CORS ÈåØË™§Ê™¢Êü•
                if (error.message.includes('Failed to fetch')) {
                    log('\nÂèØËÉΩÊòØ CORS ÈåØË™§ÔºåË´ãÊ™¢Êü•Ôºö', 'info');
                    log('1. API ÊòØÂê¶ÂÖÅË®±‰æÜËá™Ê≠§Á∂≤ÂüüÁöÑË´ãÊ±Ç', 'info');
                    log('2. ÊòØÂê¶ÈúÄË¶ÅÁâπÂÆöÁöÑ headers', 'info');
                    log('3. Á∂≤Ë∑ØÈÄ£Á∑öÊòØÂê¶Ê≠£Â∏∏', 'info');
                }
            }
            
            log('\n========== Ê∏¨Ë©¶ÁµêÊùü ==========', 'info');
        }
        
        // Êåâ Enter Èçµ‰πüÂèØ‰ª•Ê∏¨Ë©¶
        document.getElementById('characterId').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                testAPI();
            }
        });
    </script>
</body>
</html>